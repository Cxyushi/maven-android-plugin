#summary How to use ProGuard with maven-android-plugin

= Introduction =

When packaging an apk, all classes of all libraries used by the program will be included, this makes the apk very huge, even exceeds [http://code.google.com/p/android/issues/detail?id=7147#c6 the capacity of dex]. !ProGuard can strip unused classes and methods, make it as small as possible.

= Details =

The possibility to use !ProGuard together with maven-android-plugin was introduced in maven-android-plugin 2.6.0, with this patch:

http://github.com/jayway/maven-android-plugin/pull/2 

To let !ProGuard process the project, add proguard-maven-plugin

{{{
  <build>
    <plugins>
      <plugin>
        <groupId>com.pyx4me</groupId>
        <artifactId>proguard-maven-plugin</artifactId>
        <version>2.0.4</version>
        <executions>
          <execution>
            <phase>process-classes</phase>
            <goals>
              <goal>proguard</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <injar>android-classes</injar>
          <libs>
            <lib>${java.home}/lib/rt.jar</lib>
          </libs>
          <obfuscate>false</obfuscate>
          <options>
            <option> -keep public class * extends android.app.Activity</option>
            <option>-keep public class * extends android.app.Application</option>
            <option>-keep public class * extends android.app.Service</option>
            <option>-keep public class * extends
              android.content.BroadcastReceiver</option>
            <option>-keep public class * extends
              android.content.ContentProvider</option>
            <option>-dontskipnonpubliclibraryclasses</option>
            <option>-dontoptimize</option>
            <option>-printmapping map.txt</option>
            <option>-printseeds seed.txt</option>
            <option>-ignorewarnings</option>
          </options>
        </configuration>
      </plugin>
    </plugins>
  </build>
}}}

For options please refer to [http://pyx4me.com/pyx4me-maven-plugins/proguard-maven-plugin/ proguard-maven-plugin] and [http://proguard.sourceforge.net/ ProGuard]. Depending on libraries you include in your application your proguard configuration might have to change.

For running this on MacOSX you might have to create a symlink for rt.jar. See instructions here                                [http://bruehlicke.blogspot.com/2009/11/missing-rtjar-mac-os-x-using-proguard.html]. A more generic approach for the different path name is using profiles and an example can be found in the MorseFlash sample.
 
= Samples =

Complete setup with more options and operating system switch for different rt.jar and so on

https://github.com/jayway/maven-android-plugin-samples/blob/stable/morseflash/morseflash-app/pom.xml

Use maven-android-plugin with scala and !ProGuard

http://github.com/jayway/maven-android-plugin-samples/tree/stable/scala/